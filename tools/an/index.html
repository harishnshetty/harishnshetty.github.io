<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ansible YAML Generator with Config Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen flex flex-col lg:flex-row items-center justify-center p-6">


   <div class="w-full lg:w-80 bg-gray-50 p-6 shadow-inner lg:shadow-none lg:fixed lg:left-0 lg:top-0 lg:h-screen overflow-y-auto z-10">
    <div class="text-center">
      <h3 class="text-xl font-bold">Ansible Page</h3>
<img src="img/image.png" alt="Harish N Shetty" class="w-40 h-40 rounded-2xl mx-auto mb-4 shadow-md border border-gray-300" />
      <h2 class="text-xl font-bold">Harish N Shetty</h2>
      <p class="text-sm text-gray-600 mb-2">harishnshetty ‚Ä¢ he/him</p>
      <p class="text-sm mb-4">DevOps Learner || Open Source Enthusiast || Keep learning, sharing and growing</p>

<ul class="text-left text-sm space-y-2">
  <li><strong>Status:</strong> <span class="text-green-600">open to work</span></li>
  <li><strong>Location:</strong> Bengaluru, Karnataka, India</li>
  <li><strong>Email:</strong> <a href="mailto:harishn662@gmail.com" class="text-blue-600 underline">harishn662@gmail.com</a></li>
  <li><strong>Website:</strong> <a href="https://harishnshetty.github.io" class="text-blue-600 underline" target="_blank">harishnshetty.github.io</a></li>
  <li><strong>LinkedIn:</strong> <a href="https://www.linkedin.com/in/harishnshetty" class="text-blue-600 underline" target="_blank">harishnshetty</a></li>
  <li><strong>GitHub:</strong> <a href="https://github.com/harishnshetty" class="text-blue-600 underline" target="_blank">@harishnshetty</a></li>
  <li><strong>YouTube:</strong> <a href="https://www.youtube.com/@HarishNShetty0107" class="text-blue-600 underline" target="_blank">@HarishNShetty0107</a></li>
  <li><strong>Instagram:</strong> <a href="https://www.instagram.com/devopswithharish?igsh=YWc5ZzNmdzBzNjI4" class="text-blue-600 underline" target="_blank">@devopswithharish</a></li>
  <li><strong>Twitter (X):</strong> <a href="https://x.com/devopswitharish?t=SWH2zb-b8Dh4AGEm6tpwGg&s=09" class="text-blue-600 underline" target="_blank">@devopswitharish</a></li>
</ul>


<p class="text-lg text-red-600 font-medium text-center mt-4 mx-auto max-w-2xl">
  This is an open-source generator tool. You can support ongoing development & feature improvements.
</p>
     
<ul class="text-left text-xl font-bold text-black space-y-2">
  <li>
    <strong>PayPal:</strong>
    <a href="https://paypal.me/harishnshetty" class="text-blue-700 underline font-bold">@harishnshetty</a>
  </li>
  <li>
    <strong>UPI ID:</strong> harishn662@ybl
  </li>
</ul>


            <img src="img/qr1.png" alt="Harish N Shetty" class="w-45 h-45  mx-auto mb-4">
<br> Desgin & Developed By</br><strong>Harish N Shetty</strong> 
    </div>
  </div>

<div class="flex-0 p-1 overflow-y-auto lg:ml-80"></div>
  <div class="max-w-4xl w-full bg-white rounded-xl shadow-md p-6">

<a href="update.html" target="_blank">
  <div id="latestUpdate" class="mb-4 w-full max-w-full text-sm text-blue-800 bg-blue-100 p-3 rounded hidden cursor-pointer hover:bg-blue-200 transition">
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3 w-full">
      <img src="img/7.gif" alt="update" class="w-10 h-10 sm:w-7 sm:h-7 flex-shrink-0" />
      <span id="updateMessage" class="text-sm sm:text-base font-medium break-words whitespace-pre-wrap w-full">
        <svg class="animate-spin inline-block w-5 h-5 text-blue-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
        </svg>
        Fetching update...
      </span>
    </div>
  </div>
</a>




    <h1 class="text-2xl font-bold mb-6 text-center"> [ Ansible YAML Generator ]  </h1>
    
<span class="space-x-4">
    <a href="https://harishnshetty.github.io" class="text-blue-600 underline" target="_blank">Home</a>

  <a href="ansible.pdf" class="text-blue-600 underline" target="_blank">Ansible-PDF</a>
  <a href="https://www.youtube.com/playlist?list=PLB1yU-G7FE-ENj8uOF2wuiU_AWdvZAI7H" class="text-blue-600 underline" target="_blank">‚ñ∂Ô∏è YouTube-Playlist</a>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSe_tqab3RWclUkxWWtBKdqYp0wjoGlCawZIYDT1itX-xAnY2g/viewform?usp=dialog" class="text-blue-600 underline" target="_blank">‚úçÔ∏è Feedback-Form</a>
  <a href="https://harishnshetty.github.io/feedback/ansible.html" class="text-blue-600 underline" target="_blank">ü§ùüòä Read-Feedback-Messages</a>
    <a href="lic.txt" class="text-blue-600 underline" target="_blank">üîëLICENSE</a>

</span>


  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"></div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">

      




    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
  <div>
    <label for="os" class="font-semibold block mb-1">Select OS:</label>
    <select id="os" class="w-full p-2 border rounded">
      <option value="ubuntu">Ubuntu</option>
      <option value="redhat">RedHat</option>
      <option value="amazon">Amazon Linux</option>
      <option value="alpine">Alpine</option>
    </select>
  </div>

  <div>
    <label for="appDropdownButton" class="font-semibold block mb-1">Select Applications:</label>
<button id="appDropdownButton" class="w-full p-2 border border-black rounded bg-white text-left focus:outline-none">
      Select Applications
    </button>
    
    <div id="appDropdownMenu" class="absolute z-10 hidden bg-white border rounded mt-1 w-full max-h-64 overflow-y-auto shadow-lg">
      <div class="p-2 font-semibold bg-gray-100">Web Servers</div>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="nginx">Nginx
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="apache2">Apache2
      </label>

      <div class="p-2 font-semibold bg-gray-100">Databases</div>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="mysql">MySQL
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="mariadb">MariaDB
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="postgresql">PostgreSQL
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="mongodb">MongoDB
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="redis">Redis
      </label>

      <div class="p-2 font-semibold bg-gray-100">DevOps Tools</div>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="docker">Docker
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="git">Git
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="ansible">Ansible
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="terraform">Terraform
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="jenkins">Jenkins
      </label>

      <div class="p-2 font-semibold bg-gray-100">Monitoring</div>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="prometheus">Prometheus
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="grafana">Grafana
      </label>
      <label class="flex items-center px-4 py-2 hover:bg-gray-50">
        <input type="checkbox" class="app-checkbox mr-2" value="zabbix-agent">Zabbix Agent
      </label>
    </div>
  </div>
</div>


<div class="mt-6 flex flex-wrap gap-4">
  </div>


<script>
document.addEventListener("click", function (e) {
  setTimeout(() => {
    const button = document.getElementById("appDropdownButton");
    const menu = document.getElementById("appDropdownMenu");

    if (!button.contains(e.target) && !menu.contains(e.target)) {
      menu.classList.add("hidden");
    }
  }, 100); // Delay enough to let toggle finish first
});

// ADDED THIS PART TO TOGGLE THE DROPDOWN WHEN THE BUTTON IS CLICKED
document.getElementById("appDropdownButton").addEventListener("click", function(event) {
    event.stopPropagation(); // Prevent the document click listener from immediately closing it
    const menu = document.getElementById("appDropdownMenu");
    menu.classList.toggle("hidden");
});


  // Update button label based on selected items
  document.querySelectorAll(".app-checkbox").forEach((checkbox) => {
    checkbox.addEventListener("change", () => {
      const selected = [...document.querySelectorAll(".app-checkbox:checked")].map(cb => cb.value);
      document.getElementById("appDropdownButton").textContent = selected.length > 0 ? selected.join(", ") : "Select Applications";
      // Also trigger config update if config checkbox is checked
      const configCheckbox = document.getElementById("configCheckbox");
      if (configCheckbox.checked) {
        updateConfigEditor();
      }
      // Also trigger copy path dropdown update if copy content checkbox is checked
      const copyContentCheckbox = document.getElementById("copyContentCheckbox");
      if (copyContentCheckbox.checked && selected.length > 0) {
        updateCopyPathDropdown(selected[0]); // Update based on the first selected app
      }
    });
  });
</script>


    <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4 items-start">
  <!-- Basic Applications -->
  <div>
    <label class="inline-flex items-center">
      <input type="checkbox" value="basic-app" class="action mr-2" />
      <span class="font-semibold">Basic Applications</span>
    </label>
  </div>
</div>

<!-- Actions -->
<div class="mt-4">
  <p class="font-semibold mb-1">Actions:</p>
  <div class="flex flex-wrap gap-4">
    <label class="inline-flex items-center">
      <input type="checkbox" value="sys-update" class="action mr-2" /> System update
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" value="install" class="action mr-2" /> Install
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" value="reload" class="action mr-2" /> Reload
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" value="remove" class="action mr-2" /> Remove
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" id="purgeConfig" class="mr-2" /> apt only (purge)
    </label>
  </div>
</div>

<!-- Optional Features -->
<div class="mt-4">
  <p class="font-semibold mb-1">Optional Features:</p>
  <div class="flex flex-wrap gap-4">
    <label class="inline-flex items-center">
      <input type="checkbox" id="configCheckbox" value="config" class="feature mr-2" /> Config
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" id="createUser" value="user" class="feature mr-2" /> User Create
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" id="copyContentCheckbox" value="cp-content" class="feature mr-2" /> Copy Content
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" value="ssl" class="feature mr-2" /> SSL
    </label>
    <label class="inline-flex items-center">
      <input type="checkbox" value="enableFirewall" class="feature mr-2" /> Firewall
    </label>
  </div>
</div>


      <div id="firewallOptions" class="mt-2 ml-6 hidden">
        <label class="block font-medium mb-1">Firewall Tool:</label>
        <select id="firewallTool" class="w-full p-2 border rounded mb-2">
          <option value="ufw">UFW (Ubuntu)</option>
          <option value="firewalld">Firewalld (RedHat/CentOS)</option>
          <option value="iptables">iptables (Alpine/Manual)</option>
        </select>

 <label class="block font-medium mb-1">Allow Ports:</label>
        <div class="grid grid-cols-2 gap-2 text-sm">
          <label><input type="checkbox" value="80" class="fw-port mr-1"> HTTP (80)</label>
          <label><input type="checkbox" value="443" class="fw-port mr-1"> HTTPS (443)</label>
          <label><input type="checkbox" value="3306" class="fw-port mr-1"> MySQL (3306)</label>
          <label><input type="checkbox" value="27017" class="fw-port mr-1"> MongoDB (27017)</label>
          <label><input type="checkbox" value="8080" class="fw-port mr-1"> Tomcat (8080)</label>
          <label><input type="checkbox" value="22" class="fw-port mr-1"> SSH (22)</label>
        </div>
      
</div>

    <div id="configEditorContainer" class="mt-4 hidden">
      <label for="configEditor" class="font-semibold">Edit Configuration Template:</label>
      <textarea
        id="configEditor"
        rows="12"
        class="w-full mt-2 p-2 border rounded font-mono text-sm"
      ></textarea>
    </div>

    
 
  </div>


  <div class="mt-6 flex gap-4">
      <button onclick="generateYAML()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Generate YAML
      </button>
      <button onclick="copyYAML()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
  Copy YAML
</button>

      <button onclick="downloadYAML()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
        Download YAML
      </button>
      <button onclick="clearYAML()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
  Clear Output
</button><br>

    </div>
     <div class="mt-6">
      <label class="font-semibold">Generated YAML:</label>
<pre id="output" class="bg-gray-100 p-4 rounded whitespace-pre text-sm font-mono border border-gray-300 mt-2"></pre>
    </div>
</div>
   
  </div>


  <script>
    // Default config templates for apps
    const defaultConfigs = {
      nginx: `
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
  worker_connections 768;
}

http {
  sendfile on;
  tcp_nopush on;
  types_hash_max_size 2048;

  server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    location / {
      try_files $uri $uri/ =404;
    }
  }
}
`.trim(),

      mysql: `
[mysqld]
user=mysql
pid-file=/var/run/mysqld/mysqld.pid
socket=/var/run/mysqld/mysqld.sock
datadir=/var/lib/mysql
log-error=/var/log/mysql/error.log
`.trim(),

      mariadb: `
[mysqld]
user=mariadb
pid-file=/var/run/mariadb/mariadb.pid
socket=/var/run/mariadb/mariadb.sock
datadir=/var/lib/mariadb
log-error=/var/log/mariadb/error.log
`.trim(),

      mongodb: `
# mongod.conf

storage:
  dbPath: /var/lib/mongodb
  journal:
    enabled: true

net:
  bindIp: 127.0.0.1
  port: 27017

security:
  authorization: enabled
`.trim(),

      nodejs: `
# Example ecosystem.config.js for PM2
module.exports = {
  apps : [{
    name: "app",
    script: "./app.js",
    instances: "max",
    autorestart: true,
    watch: false,
    max_memory_restart: "1G"
  }]
};
`.trim(),
httpd: `
ServerRoot "/etc/httpd"
Listen 80

Include conf.modules.d/*.conf
User apache
Group apache

DocumentRoot "/var/www/html"
<Directory "/var/www">
    AllowOverride None
    Require all granted
</Directory>
`.trim(),

  apache2: `
<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    ErrorLog \${APACHE_LOG_DIR}/error.log
    CustomLog \${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
`.trim(),

  maven: `
<settings>
  <localRepository>/path/to/local/repo</localRepository>
  <interactiveMode>true</interactiveMode>
</settings>
`.trim(),

  openjdk11: `
# Java 11 environment configuration
JAVA_HOME=/usr/lib/jvm/java-11-openjdk
PATH=$JAVA_HOME/bin:$PATH
export JAVA_HOME
export PATH
`.trim(),

  openjdk17: `
# Java 17 environment configuration
JAVA_HOME=/usr/lib/jvm/java-17-openjdk
PATH=$JAVA_HOME/bin:$PATH
export JAVA_HOME
export PATH
`.trim(),

  openjdk21: `
# Java 21 environment configuration
JAVA_HOME=/usr/lib/jvm/java-21-openjdk
PATH=$JAVA_HOME/bin:$PATH
export JAVA_HOME
export PATH
`.trim(),
};

    // Helper to update the config editor content
    function updateConfigEditor() {
      const configCheckbox = document.getElementById("configCheckbox");
      const editor = document.getElementById("configEditor");
      const selectedApps = [...document.querySelectorAll(".app-checkbox:checked")].map(cb => cb.value);

      if (configCheckbox.checked) {
        if (selectedApps.length > 0) {
          const firstSelectedApp = selectedApps[0];
          editor.value = defaultConfigs[firstSelectedApp] || `# No template available for ${firstSelectedApp}`;
        } else {
          editor.value = "# Select an application to load its config template";
        }
        document.getElementById("configEditorContainer").classList.remove("hidden");
      } else {
        document.getElementById("configEditorContainer").classList.add("hidden");
        editor.value = "";
      }
    }

    // Show/hide config editor and load template when checkbox toggled
    document.getElementById("configCheckbox").addEventListener("change", updateConfigEditor);

    // Initial update when the page loads if config checkbox is pre-checked (unlikely, but good practice)
    document.addEventListener("DOMContentLoaded", updateConfigEditor);


function generateYAML() {
  const os = document.getElementById("os").value;
  const selectedApps = [...document.querySelectorAll(".app-checkbox:checked")].map(cb => cb.value);
  const actions = [...document.querySelectorAll(".action:checked")].map(el => el.value);
  const features = [...document.querySelectorAll(".feature:checked")].map(el => el.value);
  const configContent = document.getElementById("configEditor").value;

  let yaml = `- name: Manage apps on ${os}\n  hosts: all\n  become: true\n  tasks:\n`;

  if (actions.includes("sys-update")) {
    yaml += getUpdateTask(os);
  }

if (actions.includes("basic-app")) {
  yaml += getBasicAppPackages(os);
}

  // App-specific actions
  for (const app of selectedApps) {
  if (actions.includes("install")) yaml += getInstallTask(os, app);
  if (actions.includes("remove")) yaml += getRemoveTask(os, app);
  if (actions.includes("reload")) yaml += getReloadTask(app);
  if (features.includes("user")) yaml += getUserCreationTask(app);

  if (features.includes("config")) {
    const configDestPath = getConfigDestinationPath(app);
    const indented = configContent.split("\n").map(l => "      " + l).join("\n");
    yaml += `  - name: Configure ${app}\n    copy:\n      content: |\n${indented}\n    dest: ${configDestPath}\n    owner: root\n    group: root\n    mode: '0644'\n\n`;
  }

  if (features.includes("cp-content")) {
    let path = document.getElementById("copyContentPathSelect")?.value;
    if (path === "custom") {
      const customPath = document.getElementById("customCopyPath")?.value.trim();
      path = customPath || "/var/www/html/index.html";
    }
    yaml += `  - name: Copy index.html to ${path}\n    copy:\n      src: files/index.html\n      dest: ${path}\n      owner: root\n      group: root\n      mode: '0644'\n\n`;
  }

  if (features.includes("ssl")) yaml += getFeatureTask(app, "ssl");
  if (features.includes("enableFirewall")) yaml += getFeatureTask(app, "enableFirewall");
}

// üîÑ Global features when no apps are selected
if (selectedApps.length === 0) {
  if (features.includes("config")) {
    const indented = configContent.split("\n").map(l => "      " + l).join("\n");
    yaml += `  - name: Apply general configuration\n    copy:\n      content: |\n${indented}\n    dest: /etc/default.conf\n    owner: root\n    group: root\n    mode: '0644'\n\n`;
  }

  if (features.includes("cp-content")) {
    let path = document.getElementById("copyContentPathSelect")?.value || "/var/www/html/index.html";
    if (path === "custom") {
      const customPath = document.getElementById("customCopyPath")?.value.trim();
      path = customPath || "/var/www/html/index.html";
    }
    yaml += `  - name: Copy index.html to ${path}\n    copy:\n      src: files/index.html\n      dest: ${path}\n      owner: root\n      group: root\n      mode: '0644'\n\n`;
  }

  if (features.includes("enableFirewall")) yaml += getFeatureTask(null, "enableFirewall");
  if (features.includes("ssl")) yaml += getFeatureTask(null, "ssl");
}

  document.getElementById("output").textContent = yaml;
}


    // Helper to determine config destination path
    function getConfigDestinationPath(app) {
      switch (app) {
        case 'nginx':
          return '/etc/nginx/nginx.conf';
        case 'apache2':
        case 'httpd':
          return '/etc/apache2/apache2.conf'; // or /etc/httpd/conf/httpd.conf
        case 'mysql':
          return '/etc/mysql/my.cnf';
        case 'mariadb':
          return '/etc/mariadb/mariadb.conf';
        case 'mongodb':
          return '/etc/mongod.conf';
        // Add more app-specific paths here
        default:
          return `/etc/${app}/${app}.conf`;
      }
    }


    function getUpdateTask(os) {
  if (["ubuntu", "debian"].includes(os)) {
    return `  - name: Update apt cache\n    apt:\n      update_cache: yes\n\n`;
  } else if (os === "redhat") {
    return `  - name: Update DNF packages\n    dnf:\n      name: "*"\n      state: latest\n\n`;
  } else if (os === "amazon") {
    return `  - name: Update YUM packages\n    yum:\n      name: "*"\n      state: latest\n\n`;
  } else if (os === "alpine") {
    return `  - name: Update APK packages\n    apk:\n      update_cache: yes\n\n`;
  }
  return "";
}


function getBasicAppPackages(os) {
  const packagesByOS = {
    ubuntu: [
      "vim", "nano", "net-tools", "iproute2", "curl", "wget", "telnet", "dnsutils",
      "htop", "lsof", "psmisc", "git", "build-essential", "ca-certificates",
      "gnupg", "openssh-client", "sudo"
    ],
    redhat: [
      "vim", "nano", "net-tools", "iproute", "curl", "wget", "telnet", "bind-utils",
      "htop", "lsof", "psmisc", "git", "gcc", "make", "gcc-c++", "ca-certificates",
      "gnupg2", "openssh-clients", "sudo"
    ],
    amazon: [
      "vim", "nano", "net-tools", "iproute", "curl", "wget", "telnet", "bind-utils",
      "htop", "lsof", "psmisc", "git", "gcc", "make", "gcc-c++", "ca-certificates",
      "gnupg2", "openssh-clients", "sudo"
    ],
    alpine: [
      "vim", "nano", "iproute2", "net-tools", "curl", "wget", "bind-tools", "nc",
      "htop", "lsof", "procps", "psmisc", "git", "build-base", "ca-certificates",
      "gnupg", "openssh", "sudo"
    ]
  };

  const pkgList = packagesByOS[os] || [];

  if (pkgList.length === 0) return "";

  let installLine = "";

  if (os === "ubuntu" || os === "debian") {
    installLine = `  - name: Install basic packages\n    apt:\n      name:\n${pkgList.map(p => `        - ${p}`).join("\n")}\n      state: present\n      update_cache: yes\n\n`;
  } else if (os === "redhat") {
    installLine = `  - name: Install basic packages\n    dnf:\n      name:\n${pkgList.map(p => `        - ${p}`).join("\n")}\n      state: present\n\n`;
  } else if (os === "amazon") {
    installLine = `  - name: Install basic packages\n    yum:\n      name:\n${pkgList.map(p => `        - ${p}`).join("\n")}\n      state: present\n\n`;
  } else if (os === "alpine") {
    installLine = `  - name: Install basic packages\n    apk:\n      name:\n${pkgList.map(p => `        - ${p}`).join("\n")}\n      state: present\n\n`;
  }

  return installLine;
}

    function getInstallTask(os, app) {
  if (os === "ubuntu" || os === "debian") {
    return `  - name: Install ${app}\n    apt:\n      name: ${app}\n      state: present\n      update_cache: yes\n\n`;
  } else if (os === "redhat") {
    return `  - name: Install ${app}\n    dnf:\n      name: ${app}\n      state: present\n\n`;
  } else if (os === "amazon") {
    return `  - name: Install ${app}\n    yum:\n      name: ${app}\n      state: present\n\n`;
  } else if (os === "alpine") {
    return `  - name: Install ${app}\n    apk:\n      name: ${app}\n      state: present\n\n`;
  }
  return "";
}


function getRemoveTask(os, app) {
  const purge = document.getElementById("purgeConfig")?.checked;

  if (os === "ubuntu") {
    return `  - name: Remove ${app}${purge ? " and purge config" : ""}\n    apt:\n      name: ${app}\n      state: absent\n${purge ? "      purge: yes\n" : ""}\n`;
  } else if (os === "redhat") {
    return `  - name: Remove ${app}\n    dnf:\n      name: ${app}\n      state: absent\n\n`;
  } else if (os === "amazon") {
    return `  - name: Remove ${app}\n    yum:\n      name: ${app}\n      state: absent\n\n`;
  } else if (os === "alpine") {
    return `  - name: Remove ${app}\n    apk:\n      name: ${app}\n      state: absent\n\n`;
  }

  return "";
}


function getReloadTask(app) {
    return `  - name: Reload ${app} service\n    service:\n      name: ${app}\n      state: reloaded\n\n`;
  }
    function getFeatureTask(app, feature) {
  if (feature === "enableFirewall") {

    const fwTool = document.getElementById("firewallTool")?.value || "ufw";
    const ports = [...document.querySelectorAll(".fw-port:checked")].map(p => p.value);

    let rules = "";

    ports.forEach(port => {
      if (fwTool === "ufw") {
        rules += `  - name: Allow port ${port} with UFW\n    ufw:\n      rule: allow\n      port: ${port}\n\n`;
      } else if (fwTool === "firewalld") {
        rules += `  - name: Allow port ${port} with firewalld\n    firewalld:\n      port: ${port}/tcp\n      permanent: true\n      state: enabled\n      immediate: yes\n\n`;
      } else if (fwTool === "iptables") {
        rules += `  - name: Allow port ${port} with iptables\n    command: iptables -A INPUT -p tcp --dport ${port} -j ACCEPT\n\n`;
      }
    });

    return rules;
  }

  if (feature === "ssl") {
    return `  - name: Setup SSL for ${app}\n    copy:\n      src: files/ssl-cert.crt\n      dest: /etc/ssl/certs/${app}.crt\n\n`;
  }

  return "";
}

function getUserCreationTask(app) {
  const users = {
    nginx: { name: 'www-data', home: '/var/www', group: 'www-data' },
    httpd: { name: 'apache', home: '/var/www', group: 'apache' },
    apache2: { name: 'www-data', home: '/var/www', group: 'www-data' },
    mysql: { name: 'mysql', home: '/var/lib/mysql', group: 'mysql' },
    mariadb: { name: 'mariadb', home: '/var/lib/mariadb', group: 'mariadb' },
    mongodb: { name: 'mongodb', home: '/var/lib/mongodb', group: 'mongodb' },
    nodejs: { name: 'nodeapp', home: '/home/nodeapp', group: 'nodeapp' },
    maven: { name: 'developer', home: '/home/developer', group: 'developer' },
    openjdk11: { name: 'developer', home: '/home/developer', group: 'developer' },
    openjdk17: { name: 'developer', home: '/home/developer', group: 'developer' },
    openjdk21: { name: 'developer', home: '/home/developer', group: 'developer' }
  };

  const u = users[app] || { name: 'webadmin', home: '/home/webadmin', group: 'webadmin' };

  return `  - name: Create ${u.name} user\n    user:\n      name: ${u.name}\n      group: ${u.group}\n      home: ${u.home}\n      state: present\n      create_home: yes\n\n`;
}

     document.addEventListener("DOMContentLoaded", function () {
    const firewallCheckbox = document.querySelector('input[type="checkbox"][value="enableFirewall"]');
    const firewallOptions = document.getElementById("firewallOptions");

    if (firewallCheckbox && firewallOptions) {
      firewallCheckbox.addEventListener("change", function () {
        if (this.checked) {
          firewallOptions.classList.remove("hidden");
        } else {
          firewallOptions.classList.add("hidden");
        }
      });
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
  const copyCheckbox = document.getElementById("copyContentCheckbox");
  // No action needed here, as the listeners below handle visibility
});

const appToPaths = {
  nginx: ["/var/www/html/index.html", "/etc/nginx/sites-available/default"],
  httpd: ["/var/www/html/index.html", "/etc/httpd/conf/httpd.conf"],
  apache2: ["/var/www/html/index.html", "/etc/apache2/sites-available/000-default.conf"],
  mariadb: ["/etc/mysql/my.cnf", "/etc/mariadb/mariadb.conf.d/"],
  maven: ["/etc/maven/settings.xml", "/home/user/.m2/settings.xml"],
  openjdk11: ["/etc/environment", "/usr/lib/jvm/java-11-openjdk"],
  openjdk17: ["/etc/environment", "/usr/lib/jvm/java-17-openjdk"],
  openjdk21: ["/etc/environment", "/usr/lib/jvm/java-21-openjdk"],
  mongodb: ["/etc/mongod.conf", "/var/lib/mongodb/index.html"]
};

function updateCopyPathDropdown(app) {
  const select = document.getElementById("copyContentPathSelect");
  const customInput = document.getElementById("customCopyPath");
  select.innerHTML = "";
  customInput.classList.add("hidden");

  // Ensure `app` is valid and present in appToPaths, otherwise default
  const paths = appToPaths[app] || ["/var/www/html/index.html"];
  paths.forEach(path => {
    const option = document.createElement("option");
    option.value = path;
    option.textContent = path;
    select.appendChild(option);
  });

  // Add "custom" option
  const customOption = document.createElement("option");
  customOption.value = "custom";
  customOption.textContent = "üîß Enter custom path";
  select.appendChild(customOption);
}


// Show/hide and update on checkbox + app change
document.getElementById("copyContentCheckbox").addEventListener("change", function () {
  const select = document.getElementById("copyContentPathSelect");
  select.classList.toggle("hidden", !this.checked);
  if (this.checked) {
    const selectedApps = [...document.querySelectorAll(".app-checkbox:checked")].map(cb => cb.value);
    if (selectedApps.length > 0) {
      updateCopyPathDropdown(selectedApps[0]); // Update based on the first selected app
    } else {
      updateCopyPathDropdown(null); // No app selected, load default options if desired
    }
  }
});


document.getElementById("copyContentPathSelect").addEventListener("change", function () {
  const customInput = document.getElementById("customCopyPath");
  if (this.value === "custom") {
    customInput.classList.remove("hidden");
  } else {
    customInput.classList.add("hidden");
  }
});

   function downloadYAML() {
  const yaml = document.getElementById("output").textContent;
  const blob = new Blob([yaml], { type: "text/yaml" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "playbook.yml";
  a.click();

  alert("Download started!");
}




function copyYAML() {
  const output = document.getElementById("output");
  if (output?.textContent) {
    navigator.clipboard.writeText(output.textContent).then(() => {
     showToast("‚úÖ YAML copied!");

    });
  }
}

function showToast(message) {
  const toast = document.createElement("div");
  toast.textContent = message;
  toast.className = "fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-md z-50";
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// Duplicated fetchLatestUpdate function removed, keeping only one.
// The initial call and interval setting for fetchLatestUpdate are already there.

function clearYAML() {
  const output = document.getElementById("output");
  if (output) {
    output.textContent = "";
  }
}

document.getElementById("os").addEventListener("change", function () {
  const purgeCheckbox = document.getElementById("purgeConfig");
  const isUbuntu = this.value === "ubuntu";

  purgeCheckbox.disabled = !isUbuntu;
  if (!isUbuntu) {
    purgeCheckbox.checked = false;
  }
});
</script>

<script>
  async function fetchLatestUpdate() {
    try {
      const url = "https://script.google.com/macros/s/AKfycbxZVmJjswUOGZLNm2zR9afxjzUeSHccbW_pSXwmeaPMFVa-oJSteKwJNFWS423h5FSj/exec";
      const res = await fetch(url);
      const json = await res.json();

      // Adjust this depending on your actual data structure
      const data = Array.isArray(json) ? json : json.data;

      console.log("Fetched data:", data); // Debug check

      if (!Array.isArray(data) || data.length < 2) return;

      const [timestamp, message] = data[data.length - 1];
      const updateBox = document.getElementById("latestUpdate");
      const updateMsg = document.getElementById("updateMessage");

      const dateObj = new Date(timestamp);
      const formatted = dateObj.toLocaleString("en-IN", {
        dateStyle: "medium",
        timeStyle: "short"
      });

      updateMsg.textContent = `üïí ${formatted} ‚Äî Latest Update: ${message}`;
      updateBox.classList.remove("hidden");
    } catch (err) {
      console.error("Failed to fetch update:", err);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    fetchLatestUpdate();
    setInterval(fetchLatestUpdate, 5 * 60 * 1000); // Refresh every 5 minutes
  });
</script>


  
</body>
</html>